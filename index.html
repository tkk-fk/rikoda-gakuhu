<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>„ÇΩ„Éó„É©„Éé„É™„Ç≥„Éº„ÉÄ„Éº Êåá„Å•„Åã„ÅÑË°®</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Kaisei+Decol:wght@400;700&family=Zen+Kaku+Gothic+New:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
/* ============================================================
   VARIABLES & RESET
   ============================================================ */
:root {
    --wood-dark:  #7c4b2a;
    --wood-mid:   #b5763a;
    --wood-light: #f2d9b8;
    --wood-pale:  #fdf4e7;
    --ink:        #2a1a0a;
    --ink-light:  #6b4c2a;
    --accent:     #e8521a;
    --white:      #ffffff;
    --hole-closed:#2a1a0a;
    --hole-open:  #f9edd8;
    --shadow:     0 8px 32px rgba(124,75,42,0.18);
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: 'Zen Kaku Gothic New', 'Hiragino Kaku Gothic ProN', sans-serif;
    background-color: var(--wood-pale);
    background-image:
        radial-gradient(ellipse at 20% 10%, #f5e4c8 0%, transparent 50%),
        radial-gradient(ellipse at 80% 90%, #eedcc0 0%, transparent 50%);
    color: var(--ink);
    min-height: 100dvh;
    padding: 0 0 60px;
}

/* ============================================================
   HEADER
   ============================================================ */
header {
    background: var(--wood-dark);
    background-image: linear-gradient(135deg, #7c4b2a 0%, #9c6030 50%, #7c4b2a 100%);
    padding: 16px 20px 14px;
    text-align: center;
    position: relative;
    overflow: hidden;
}
header::before {
    content: '';
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(90deg, transparent 0px, transparent 30px, rgba(255,255,255,0.03) 30px, rgba(255,255,255,0.03) 31px);
}
header h1 {
    font-family: 'Kaisei Decol', serif;
    font-size: clamp(1.2rem, 4vw, 2rem);
    color: var(--wood-light);
    letter-spacing: 0.06em;
    position: relative;
}
header p {
    font-size: clamp(0.65rem, 1.8vw, 0.85rem);
    color: rgba(242,217,184,0.7);
    margin-top: 3px;
    letter-spacing: 0.1em;
    position: relative;
}

/* ============================================================
   TAB BAR
   ============================================================ */
.tab-bar {
    display: flex;
    background: #5a3218;
    border-bottom: 3px solid var(--wood-mid);
}
.tab-btn {
    flex: 1;
    padding: 13px 10px;
    background: none;
    border: none;
    cursor: pointer;
    font-family: 'Zen Kaku Gothic New', sans-serif;
    font-size: clamp(0.85rem, 2.5vw, 1.05rem);
    font-weight: 900;
    color: rgba(242,217,184,0.5);
    letter-spacing: 0.04em;
    transition: background 0.2s, color 0.2s;
    position: relative;
}
.tab-btn.active { color: var(--wood-light); background: rgba(255,255,255,0.07); }
.tab-btn.active::after {
    content: '';
    position: absolute;
    bottom: -3px; left: 0; right: 0;
    height: 3px;
    background: var(--accent);
}
.tab-btn:hover:not(.active) { color: var(--wood-light); background: rgba(255,255,255,0.04); }
.tab-content { display: none; }
.tab-content.active { display: block; }

/* ============================================================
   NOTE DISPLAY (tab1)
   ============================================================ */
.note-display-wrap {
    display: flex;
    justify-content: center;
    padding: 20px 20px 10px;
}
.note-display {
    background: var(--white);
    border: 3px solid var(--wood-mid);
    border-radius: 20px;
    padding: 10px 36px;
    font-family: 'Kaisei Decol', serif;
    font-size: clamp(1.6rem, 5vw, 2.6rem);
    font-weight: 700;
    color: var(--wood-dark);
    box-shadow: var(--shadow), inset 0 2px 0 rgba(255,255,255,0.8);
    min-width: clamp(160px, 40vw, 260px);
    text-align: center;
    transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
}
.note-display.bump { transform: scale(1.08); }

/* ============================================================
   KEYBOARD (shared styles used in both tabs)
   ============================================================ */
.keyboard-section { padding: 0 12px; }
.keyboard-scroll {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    padding: 8px 8px 14px;
    scrollbar-width: thin;
    scrollbar-color: var(--wood-mid) transparent;
}
.keyboard-scroll::-webkit-scrollbar { height: 4px; }
.keyboard-scroll::-webkit-scrollbar-thumb { background: var(--wood-mid); border-radius: 2px; }
.keyboard {
    display: inline-flex;
    background: var(--wood-dark);
    background-image: linear-gradient(180deg, #9c6030 0%, #7c4b2a 100%);
    border-radius: 14px;
    padding: 10px 12px 12px;
    box-shadow: var(--shadow), inset 0 1px 0 rgba(255,255,255,0.15);
}
.key {
    cursor: pointer;
    border: none;
    border-radius: 6px 6px 10px 10px;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 10px;
    font-family: 'Zen Kaku Gothic New', sans-serif;
    font-size: clamp(0.6rem, 1.4vw, 0.82rem);
    font-weight: 700;
    transition: transform 0.1s, box-shadow 0.1s, background 0.18s;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    position: relative;
    line-height: 1.25;
    text-align: center;
}
.key:active { transform: translateY(4px); }
.key.white {
    background: linear-gradient(180deg, #fff 0%, #f0e8d8 100%);
    color: var(--ink);
    width: clamp(42px, 7.5vw, 62px);
    height: clamp(108px, 19vw, 148px);
    box-shadow: 0 5px 0 #5a3015, inset 0 1px 0 rgba(255,255,255,0.9);
    z-index: 1;
}
.key.white:active { box-shadow: 0 1px 0 #5a3015; }
.key.black {
    background: linear-gradient(180deg, #3a2010 0%, #1a0e06 100%);
    color: var(--wood-light);
    width: clamp(32px, 5.5vw, 44px);
    height: clamp(68px, 11.5vw, 90px);
    box-shadow: 0 5px 0 #0a0500, inset 0 1px 0 rgba(255,255,255,0.12);
    z-index: 10;
    margin-left: clamp(-19px, -3.8vw, -25px);
    margin-right: clamp(-15px, -2.8vw, -21px);
    font-size: clamp(0.58rem, 1.2vw, 0.76rem);
    padding-bottom: 6px;
}
.key.black:active { box-shadow: 0 1px 0 #0a0500; }
.key.active.white { background: linear-gradient(180deg, #ffd49a 0%, #e8a848 100%); color: var(--wood-dark); }
.key.active.black { background: linear-gradient(180deg, #e8521a 0%, #b83a08 100%); color: #fff; }

/* ============================================================
   MAIN CONTENT / RECORDER / LEGEND (tab1)
   ============================================================ */
.main-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 24px;
    padding: 20px 20px 0;
}
@media (min-width: 640px) {
    .main-content { flex-direction: row; align-items: flex-start; justify-content: center; gap: 40px; }
}
.legend {
    background: var(--white);
    border: 2px solid var(--wood-mid);
    border-radius: 16px;
    padding: 16px 20px;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.legend h3 { font-family: 'Kaisei Decol', serif; font-size: 1rem; color: var(--wood-dark); border-bottom: 2px solid var(--wood-light); padding-bottom: 8px; margin-bottom: 2px; }
.legend-item { display: flex; align-items: center; gap: 12px; font-size: 0.88rem; font-weight: 700; color: var(--ink-light); }
.legend-icon { width: 20px; height: 20px; border-radius: 50%; border: 2px solid #555; flex-shrink: 0; }
.legend-icon.closed { background: var(--hole-closed); }
.legend-icon.open   { background: var(--hole-open); border-color: #999; }
.legend-icon.half   { background: linear-gradient(to right, var(--hole-closed) 50%, var(--hole-open) 50%); }
.legend-icon.thumb-half { background: linear-gradient(to bottom, var(--hole-open) 30%, var(--hole-closed) 30%); }

.recorder-diagram { display: flex; flex-direction: column; align-items: center; }
.recorder-body-wrap { display: flex; gap: 12px; align-items: flex-start; }
.recorder-body {
    width: clamp(68px, 14vw, 88px);
    background: linear-gradient(to right, #c8a07a 0%, #f2d9b8 30%, #f8edd4 50%, #f2d9b8 70%, #c8a07a 100%);
    border: 3px solid var(--wood-dark);
    border-radius: 36px 36px 12px 12px;
    padding: clamp(18px, 3.5vw, 28px) 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    box-shadow: 6px 6px 20px rgba(0,0,0,0.22), inset 2px 0 6px rgba(0,0,0,0.08);
    position: relative;
}
.recorder-body::after {
    content: '';
    position: absolute;
    inset: 10px 14px;
    background: repeating-linear-gradient(180deg, transparent 0px, transparent 12px, rgba(139,90,43,0.06) 12px, rgba(139,90,43,0.06) 13px);
    border-radius: 20px;
    pointer-events: none;
}
.recorder-body::before {
    content: '';
    position: absolute;
    top: -17px; left: 50%;
    transform: translateX(-50%);
    width: 58%; height: 17px;
    background: linear-gradient(180deg, var(--wood-dark) 0%, var(--wood-mid) 100%);
    border-radius: 6px 6px 0 0;
    border: 3px solid var(--wood-dark);
    border-bottom: none;
}
.thumb-section { display: flex; flex-direction: column; align-items: center; margin-bottom: clamp(14px, 2.8vw, 22px); }
.holes-section { display: flex; flex-direction: column; align-items: center; gap: clamp(12px, 2.5vw, 18px); }
.hole {
    border-radius: 50%;
    border: 2.5px solid rgba(0,0,0,0.5);
    transition: background 0.22s ease;
    position: relative; z-index: 2;
}
.hole.regular { width: clamp(24px, 4.5vw, 32px); height: clamp(24px, 4.5vw, 32px); }
.hole.double  { width: clamp(34px, 6.5vw, 44px); height: clamp(20px, 4vw, 26px); border-radius: 13px; }
.hole.closed    { background: var(--hole-closed); box-shadow: inset 0 2px 4px rgba(0,0,0,0.5); }
.hole.open      { background: var(--hole-open);   box-shadow: inset 0 1px 3px rgba(0,0,0,0.15); }
.hole.half      { background: linear-gradient(to right, var(--hole-closed) 50%, var(--hole-open) 50%); }
.hole.thumb-half{ background: linear-gradient(to bottom, var(--hole-open) 30%, var(--hole-closed) 30%); }
.hand-divider {
    width: 80%; height: 2px;
    background: linear-gradient(to right, transparent, var(--wood-mid), transparent);
    margin: clamp(6px, 1.5vw, 12px) 0;
}
.finger-labels {
    display: flex; flex-direction: column;
    font-size: clamp(0.6rem, 1.2vw, 0.75rem);
    font-weight: 700; color: var(--ink-light); padding-top: 2px;
}
.finger-label { display: flex; align-items: center; height: clamp(37px, 7.8vw, 50px); }
.finger-label:nth-last-child(1),.finger-label:nth-last-child(2) { height: clamp(33px, 6.8vw, 44px); }
.thumb-label-row {
    display: flex; align-items: center;
    height: clamp(33px, 6.5vw, 46px);
    margin-bottom: clamp(14px, 2.8vw, 22px);
}

/* ============================================================
   SCORE MODE ‚Äî KEYBOARD INPUT SECTION
   ============================================================ */
.score-keyboard-section {
    padding: 16px 12px 0;
}
.score-keyboard-label {
    font-family: 'Kaisei Decol', serif;
    font-size: clamp(0.9rem, 2.5vw, 1.1rem);
    color: var(--wood-dark);
    text-align: center;
    margin-bottom: 10px;
    font-weight: 700;
}
.score-keyboard-hint {
    font-size: 0.78rem;
    color: var(--ink-light);
    text-align: center;
    margin-bottom: 8px;
    font-weight: 400;
}

/* Score mode keyboard ‚Äî same style but with "add" animation */
.score-key-add {
    animation: keyAdd 0.18s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes keyAdd {
    0%   { transform: scale(0.88); }
    100% { transform: scale(1); }
}

/* ============================================================
   SCORE MODE ‚Äî TEXT INPUT + CONTROLS
   ============================================================ */
.score-controls-row {
    display: flex;
    gap: 8px;
    padding: 10px 12px 0;
    align-items: stretch;
    flex-wrap: wrap;
}
.score-text-input {
    flex: 1;
    min-width: 160px;
    font-family: 'Zen Kaku Gothic New', sans-serif;
    font-size: clamp(0.85rem, 2.2vw, 0.98rem);
    font-weight: 700;
    padding: 11px 14px;
    border: 2px solid var(--wood-mid);
    border-radius: 12px;
    background: var(--white);
    color: var(--ink);
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
}
.score-text-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(232,82,26,0.15); }
.score-text-input::placeholder { color: #bba888; font-weight: 400; }
.parse-btn {
    font-family: 'Zen Kaku Gothic New', sans-serif;
    font-size: clamp(0.8rem, 2vw, 0.92rem);
    font-weight: 900;
    padding: 11px 16px;
    background: var(--wood-mid);
    color: var(--white);
    border: none;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 4px 0 var(--wood-dark);
    transition: transform 0.1s, box-shadow 0.1s;
    white-space: nowrap;
}
.parse-btn:active { transform: translateY(3px); box-shadow: 0 1px 0 var(--wood-dark); }

.score-action-row {
    display: flex;
    gap: 8px;
    padding: 8px 12px 0;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
}
.score-action-left { display: flex; gap: 8px; flex-wrap: wrap; }
.ctrl-btn {
    font-family: 'Zen Kaku Gothic New', sans-serif;
    font-size: clamp(0.75rem, 1.9vw, 0.88rem);
    font-weight: 900;
    padding: 8px 16px;
    border: 2px solid;
    border-radius: 10px;
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.1s;
    -webkit-tap-highlight-color: transparent;
}
.ctrl-btn:active { transform: translateY(2px); }
.ctrl-btn.delete-btn {
    background: var(--white); color: var(--wood-dark);
    border-color: var(--wood-mid); box-shadow: 0 3px 0 #8b5a2b;
}
.ctrl-btn.delete-btn:active { box-shadow: 0 1px 0 #8b5a2b; }
.ctrl-btn.clear-btn {
    background: #fff0ee; color: var(--accent);
    border-color: var(--accent); box-shadow: 0 3px 0 #a83810;
}
.ctrl-btn.clear-btn:active { box-shadow: 0 1px 0 #a83810; }
.print-btn {
    font-family: 'Zen Kaku Gothic New', sans-serif;
    font-size: clamp(0.78rem, 2vw, 0.92rem);
    font-weight: 900;
    padding: 9px 20px;
    background: #2a5a3a;
    color: #e8f5ee;
    border: 2px solid #1a3a28;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 3px 0 #0e2016;
    transition: transform 0.1s, box-shadow 0.1s, background 0.15s;
    white-space: nowrap;
    display: flex; align-items: center; gap: 6px;
}
.print-btn:hover { background: #3a7a50; }
.print-btn:active { transform: translateY(2px); box-shadow: 0 1px 0 #0e2016; }
.print-btn:disabled {
    background: #aaa; border-color: #888; color: #ddd;
    box-shadow: none; cursor: not-allowed; opacity: 0.5;
}

/* ============================================================
   SEQUENCE DISPLAY
   ============================================================ */
.sequence-section { padding: 12px 12px 0; }
.sequence-header {
    display: flex; align-items: center;
    justify-content: space-between; margin-bottom: 8px;
}
.sequence-header h2 {
    font-family: 'Kaisei Decol', serif;
    font-size: clamp(0.95rem, 2.8vw, 1.2rem);
    color: var(--wood-dark);
}
.sequence-count {
    font-size: 0.78rem; font-weight: 700;
    color: var(--ink-light); background: var(--wood-light);
    padding: 3px 10px; border-radius: 20px;
}
.sequence-scroll-wrap {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    padding: 6px 4px 14px;
    scrollbar-width: thin;
    scrollbar-color: var(--wood-mid) transparent;
}
.sequence-scroll-wrap::-webkit-scrollbar { height: 5px; }
.sequence-scroll-wrap::-webkit-scrollbar-thumb { background: var(--wood-mid); border-radius: 3px; }
.sequence-container {
    display: flex;
    gap: 8px;
    align-items: flex-end;
    min-height: 190px;
    padding: 4px 4px 8px;
}
.seq-empty {
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    gap: 10px; width: 100%; min-height: 160px;
    background: rgba(255,255,255,0.5);
    border: 2px dashed var(--wood-mid);
    border-radius: 16px;
    color: var(--ink-light);
    font-size: 0.92rem; font-weight: 700; text-align: center; padding: 20px;
}
.seq-empty span { font-size: 2rem; }

/* Mini Card */
.seq-card {
    display: flex; flex-direction: column;
    align-items: center; gap: 4px;
    cursor: pointer;
    animation: cardIn 0.22s cubic-bezier(0.34,1.56,0.64,1);
    position: relative; flex-shrink: 0;
}
@keyframes cardIn {
    from { opacity: 0; transform: scale(0.65) translateY(14px); }
    to   { opacity: 1; transform: scale(1) translateY(0); }
}
.seq-card-inner {
    background: var(--white);
    border: 2.5px solid var(--wood-mid);
    border-radius: 13px;
    padding: 7px 7px 9px;
    display: flex; flex-direction: column;
    align-items: center; gap: 5px;
    box-shadow: 0 4px 10px rgba(124,75,42,0.13);
    position: relative;
    transition: border-color 0.15s, box-shadow 0.15s;
}
.seq-card:hover .seq-card-inner {
    border-color: var(--accent);
    box-shadow: 0 4px 14px rgba(232,82,26,0.18);
}
.seq-step-num {
    font-size: 0.58rem; font-weight: 900;
    color: var(--wood-mid); letter-spacing: 0.05em;
}
.seq-note-name {
    font-family: 'Kaisei Decol', serif;
    font-size: clamp(0.66rem, 1.6vw, 0.8rem);
    font-weight: 700; color: var(--wood-dark);
    text-align: center; line-height: 1.2;
    min-height: 2em; display: flex;
    align-items: center; justify-content: center;
}
.seq-delete-btn {
    position: absolute; top: -8px; right: -8px;
    width: 20px; height: 20px;
    background: var(--accent); color: #fff;
    border: 2px solid var(--white);
    border-radius: 50%;
    font-size: 0.6rem; font-weight: 900;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.22);
    opacity: 0;
    transition: opacity 0.15s, transform 0.1s;
    z-index: 20; line-height: 1;
}
.seq-card:hover .seq-delete-btn { opacity: 1; }
.seq-delete-btn:active { transform: scale(0.85); }
@media (hover: none) { .seq-delete-btn { opacity: 1; } }

/* Mini Recorder inside cards */
.mini-recorder {
    width: 28px;
    background: linear-gradient(to right, #c8a07a 0%, #f2d9b8 30%, #f8edd4 50%, #f2d9b8 70%, #c8a07a 100%);
    border: 2px solid var(--wood-dark);
    border-radius: 13px 13px 5px 5px;
    padding: 7px 0 6px;
    display: flex; flex-direction: column;
    align-items: center; gap: 4px;
    position: relative;
    box-shadow: 2px 3px 7px rgba(0,0,0,0.16);
}
.mini-recorder::before {
    content: '';
    position: absolute; top: -8px; left: 50%;
    transform: translateX(-50%);
    width: 50%; height: 8px;
    background: linear-gradient(180deg, var(--wood-dark) 0%, var(--wood-mid) 100%);
    border-radius: 3px 3px 0 0;
    border: 2px solid var(--wood-dark); border-bottom: none;
}
.mini-hole {
    width: 9px; height: 9px;
    border-radius: 50%;
    border: 1.5px solid rgba(0,0,0,0.4);
    flex-shrink: 0;
}
.mini-hole.double { width: 14px; height: 7px; border-radius: 4px; }
.mini-hole.closed    { background: var(--hole-closed); }
.mini-hole.open      { background: var(--hole-open); }
.mini-hole.half      { background: linear-gradient(to right, var(--hole-closed) 50%, var(--hole-open) 50%); }
.mini-hole.thumb-half{ background: linear-gradient(to bottom, var(--hole-open) 30%, var(--hole-closed) 30%); }
.mini-divider { width: 70%; height: 1px; background: rgba(181,118,58,0.4); flex-shrink: 0; }

/* ============================================================
   PRINT TITLE INPUT
   ============================================================ */
.print-title-row {
    display: flex;
    gap: 8px;
    padding: 8px 12px 0;
    align-items: center;
}
.print-title-label {
    font-size: 0.82rem;
    font-weight: 900;
    color: var(--ink-light);
    white-space: nowrap;
    flex-shrink: 0;
}
.print-title-input {
    flex: 1;
    font-family: 'Kaisei Decol', serif;
    font-size: clamp(0.85rem, 2vw, 0.98rem);
    font-weight: 700;
    padding: 8px 12px;
    border: 2px solid var(--wood-light);
    border-radius: 10px;
    background: var(--white);
    color: var(--wood-dark);
    outline: none;
    transition: border-color 0.2s;
}
.print-title-input:focus { border-color: var(--wood-mid); }
.print-title-input::placeholder { color: #cbb89a; font-weight: 400; font-family: 'Zen Kaku Gothic New', sans-serif; }

/* ============================================================
   PRINT STYLES
   ============================================================ */
@media print {
    * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }

    body {
        background: #fff !important;
        background-image: none !important;
        padding: 0;
        font-family: 'Zen Kaku Gothic New', 'Hiragino Kaku Gothic ProN', sans-serif;
    }

    /* Hide everything except print area */
    header, .tab-bar, #tab-fingering,
    .score-keyboard-section, .score-keyboard-label,
    .score-keyboard-hint, .score-controls-row,
    .score-action-row, .sequence-section,
    .print-title-row { display: none !important; }

    /* Show only the print sheet */
    .print-sheet { display: block !important; }

    @page {
        size: A4 portrait;
        margin: 12mm 12mm 14mm;
    }
}

/* ============================================================
   PRINT SHEET (hidden on screen, shown on print)
   ============================================================ */
.print-sheet {
    display: none;
}

/* The print sheet inner layout */
.print-sheet-inner {
    font-family: 'Zen Kaku Gothic New', 'Hiragino Kaku Gothic ProN', sans-serif;
}
.print-sheet-title {
    font-family: 'Kaisei Decol', serif;
    font-size: 18pt;
    font-weight: 700;
    color: #2a1a0a;
    text-align: center;
    margin-bottom: 4pt;
    border-bottom: 2pt solid #7c4b2a;
    padding-bottom: 6pt;
}
.print-sheet-subtitle {
    font-size: 8pt;
    color: #6b4c2a;
    text-align: center;
    margin-bottom: 10pt;
}
.print-cards-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 8pt;
    align-items: flex-start;
}

/* Print card */
.print-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4pt;
    border: 1.5pt solid #b5763a;
    border-radius: 6pt;
    padding: 6pt 6pt 7pt;
    background: #fff;
    page-break-inside: avoid;
    break-inside: avoid;
}
.print-card-num {
    font-size: 6pt;
    font-weight: 900;
    color: #b5763a;
    letter-spacing: 0.04em;
}
.print-card-name {
    font-family: 'Kaisei Decol', serif;
    font-size: 8.5pt;
    font-weight: 700;
    color: #2a1a0a;
    text-align: center;
    line-height: 1.2;
    min-height: 18pt;
    display: flex; align-items: center; justify-content: center;
}
/* Print mini recorder */
.print-recorder {
    width: 22pt;
    background: linear-gradient(to right, #c8a07a 0%, #f2d9b8 30%, #f8edd4 50%, #f2d9b8 70%, #c8a07a 100%);
    border: 1.5pt solid #2a1a0a;
    border-radius: 11pt 11pt 4pt 4pt;
    padding: 5pt 0 5pt;
    display: flex; flex-direction: column;
    align-items: center; gap: 3pt;
    position: relative;
}
.print-recorder::before {
    content: '';
    position: absolute; top: -7pt; left: 50%;
    transform: translateX(-50%);
    width: 50%; height: 7pt;
    background: linear-gradient(180deg, #2a1a0a 0%, #7c4b2a 100%);
    border-radius: 2pt 2pt 0 0;
    border: 1.5pt solid #2a1a0a; border-bottom: none;
}
.print-hole {
    width: 8pt; height: 8pt;
    border-radius: 50%;
    border: 1pt solid rgba(0,0,0,0.5);
    flex-shrink: 0;
}
.print-hole.double { width: 13pt; height: 6pt; border-radius: 4pt; }
.print-hole.closed    { background: #2a1a0a; }
.print-hole.open      { background: #f9edd8; }
.print-hole.half      { background: linear-gradient(to right, #2a1a0a 50%, #f9edd8 50%); }
.print-hole.thumb-half{ background: linear-gradient(to bottom, #f9edd8 30%, #2a1a0a 30%); }
.print-divider { width: 70%; height: 0.8pt; background: rgba(181,118,58,0.5); flex-shrink: 0; }

/* Print legend */
.print-legend {
    margin-top: 10pt;
    border-top: 1pt solid #b5763a;
    padding-top: 6pt;
    display: flex;
    gap: 14pt;
    flex-wrap: wrap;
}
.print-legend-item {
    display: flex;
    align-items: center;
    gap: 4pt;
    font-size: 7pt;
    color: #2a1a0a;
}
.print-legend-icon {
    width: 8pt; height: 8pt;
    border-radius: 50%;
    border: 1pt solid rgba(0,0,0,0.5);
    flex-shrink: 0;
}
.print-legend-icon.closed { background: #2a1a0a; }
.print-legend-icon.open   { background: #f9edd8; border-color: #999; }
.print-legend-icon.half   { background: linear-gradient(to right, #2a1a0a 50%, #f9edd8 50%); }
.print-legend-icon.thumb-half { background: linear-gradient(to bottom, #f9edd8 30%, #2a1a0a 30%); }
    </style>
</head>
<body>

<header>
    <h1>üéµ „ÇΩ„Éó„É©„Éé„É™„Ç≥„Éº„ÉÄ„Éº Êåá„Å•„Åã„ÅÑË°®</h1>
    <p>„Ç∏„É£„Éº„Éû„É≥Âºè Ôºè Èü≥„Çí„Åà„Çâ„Çì„ÅßÊåá„Å•„Åã„ÅÑ„Çí„Åã„Åè„Å´„Çì„Åó„Çà„ÅÜ</p>
</header>

<nav class="tab-bar">
    <button class="tab-btn active" data-tab="fingering">üîç Êåá„Å•„Åã„ÅÑË°®</button>
    <button class="tab-btn" data-tab="score">üéº Ê•ΩË≠ú„É¢„Éº„Éâ</button>
</nav>

<!-- ============================================================
     TAB 1: FINGERING
     ============================================================ -->
<div id="tab-fingering" class="tab-content active">
    <div class="note-display-wrap">
        <div class="note-display" id="display-note">„Éâ</div>
    </div>
    <div class="keyboard-section">
        <div class="keyboard-scroll">
            <div class="keyboard" id="keyboard"></div>
        </div>
    </div>
    <div class="main-content">
        <div class="recorder-diagram">
            <div class="recorder-body-wrap">
                <div class="finger-labels">
                    <div class="thumb-label-row">„Åä„ÇÑÊåáÔºà„ÅÜ„ÇâÔºâ</div>
                    <div class="finger-label">‰∫∫Â∑Æ„ÅóÊåá</div>
                    <div class="finger-label">‰∏≠Êåá</div>
                    <div class="finger-label">Ëñ¨Êåá</div>
                    <div class="finger-label">‰∫∫Â∑Æ„ÅóÊåá</div>
                    <div class="finger-label">‰∏≠Êåá</div>
                    <div class="finger-label">Ëñ¨Êåá</div>
                    <div class="finger-label">Â∞èÊåá</div>
                </div>
                <div class="recorder-body">
                    <div class="thumb-section"><div class="hole regular" id="hole-0"></div></div>
                    <div class="holes-section">
                        <div class="hole regular" id="hole-1"></div>
                        <div class="hole regular" id="hole-2"></div>
                        <div class="hole regular" id="hole-3"></div>
                        <div class="hand-divider"></div>
                        <div class="hole regular" id="hole-4"></div>
                        <div class="hole regular" id="hole-5"></div>
                        <div class="hole double" id="hole-6"></div>
                        <div class="hole double" id="hole-7"></div>
                    </div>
                </div>
                <div class="finger-labels">
                    <div class="thumb-label-row" style="color:var(--wood-dark);font-weight:900;">Â∑¶Êâã</div>
                    <div class="finger-label"></div>
                    <div class="finger-label"></div>
                    <div class="finger-label" style="color:var(--wood-dark);font-weight:900;">Âè≥Êâã</div>
                    <div class="finger-label"></div>
                    <div class="finger-label"></div>
                    <div class="finger-label"></div>
                    <div class="finger-label"></div>
                </div>
            </div>
        </div>
        <div class="legend">
            <h3>üéØ Ë¶ã„Åã„Åü</h3>
            <div class="legend-item"><div class="legend-icon closed"></div><span>„Å®„Åò„ÇãÔºà„Åµ„Åï„ÅêÔºâ</span></div>
            <div class="legend-item"><div class="legend-icon open"></div><span>„ÅÇ„Åë„Çã</span></div>
            <div class="legend-item"><div class="legend-icon half"></div><span>Âè≥ÂçäÂàÜ„Çí„ÅÇ„Åë„Çã</span></div>
            <div class="legend-item"><div class="legend-icon thumb-half"></div><span>„Çµ„Éü„É≥„Ç∞ÔºàÂ∞ë„Åó„ÅÇ„Åë„ÇãÔºâ</span></div>
        </div>
    </div>
</div>

<!-- ============================================================
     TAB 2: SCORE MODE
     ============================================================ -->
<div id="tab-score" class="tab-content">

    <!-- Keyboard input -->
    <div class="score-keyboard-section">
        <p class="score-keyboard-label">üéπ ÈçµÁõ§„Çí„Çø„ÉÉ„Éó„Åó„Å¶Èü≥„ÇíËøΩÂä†</p>
        <p class="score-keyboard-hint">‚Äª ÈçµÁõ§„Çí„Çø„ÉÉ„Éó„Åô„Çã„Åü„Å≥„Å´„ÄÅ„Åù„ÅÆÈü≥„ÅåÊ•ΩË≠ú„Å´ËøΩÂä†„Åï„Çå„Åæ„Åô</p>
        <div class="keyboard-scroll">
            <div class="keyboard" id="score-keyboard"></div>
        </div>
    </div>

    <!-- Text input -->
    <div class="score-controls-row">
        <input type="text" class="score-text-input" id="score-text-input"
            placeholder="„Éâ„Éâ„ÇΩ„ÇΩ„É©„É©„ÇΩ‚Ä¶ „Å®ÂÖ•Âäõ„Åó„Å¶„Çà„Åø„Åì„ÇÄ"
            inputmode="text">
        <button class="parse-btn" id="parse-btn">„Çà„Åø„Åì„ÇÄ</button>
    </div>

    <!-- Title input for print -->
    <div class="print-title-row">
        <span class="print-title-label">üñ® Êõ≤ÂêçÔºö</span>
        <input type="text" class="print-title-input" id="print-title-input" placeholder="ÔºàÂç∞Âà∑ÊôÇ„ÅÆ„Çø„Ç§„Éà„É´„ÇíÂÖ•ÂäõÔºâ">
    </div>

    <!-- Action row -->
    <div class="score-action-row">
        <div class="score-action-left">
            <button class="ctrl-btn delete-btn" id="delete-last-btn">‚¨Ö ÊúÄÂæå„ÇíÂâäÈô§</button>
            <button class="ctrl-btn clear-btn" id="clear-all-btn">üóë ÂÖ®Ê∂à„Åó</button>
        </div>
        <button class="print-btn" id="print-btn" disabled>üñ® Âç∞Âà∑„Åô„Çã</button>
    </div>

    <!-- Sequence -->
    <div class="sequence-section">
        <div class="sequence-header">
            <h2>üìã Êåá„Å•„Åã„ÅÑ„ÅÆÈ†ÜÁï™</h2>
            <div class="sequence-count" id="seq-count">0 Èü≥</div>
        </div>
        <div class="sequence-scroll-wrap">
            <div class="sequence-container" id="seq-container">
                <div class="seq-empty" id="seq-empty">
                    <span>üéµ</span>
                    ÈçµÁõ§„Çí„Çø„ÉÉ„Éó„Åô„Çã„Å®„ÄÅ„Åì„Åì„Å´Êåá„Å•„Åã„ÅÑ„ÅåÈ†ÜÁï™„Å´‰∏¶„Å≥„Åæ„Åô
                </div>
            </div>
        </div>
    </div>

</div>

<!-- ============================================================
     PRINT SHEET (screen: hidden, print: shown)
     ============================================================ -->
<div class="print-sheet" id="print-sheet">
    <div class="print-sheet-inner">
        <div class="print-sheet-title" id="print-sheet-title">„ÇΩ„Éó„É©„Éé„É™„Ç≥„Éº„ÉÄ„Éº Êåá„Å•„Åã„ÅÑ</div>
        <div class="print-sheet-subtitle">„Ç∏„É£„Éº„Éû„É≥Âºè</div>
        <div class="print-cards-grid" id="print-cards-grid"></div>
        <div class="print-legend">
            <div class="print-legend-item"><div class="print-legend-icon closed"></div>„Å®„Åò„Çã</div>
            <div class="print-legend-item"><div class="print-legend-icon open"></div>„ÅÇ„Åë„Çã</div>
            <div class="print-legend-item"><div class="print-legend-icon half"></div>Âè≥ÂçäÂàÜ„Çí„ÅÇ„Åë„Çã</div>
            <div class="print-legend-item"><div class="print-legend-icon thumb-half"></div>„Çµ„Éü„É≥„Ç∞ÔºàÂ∞ë„Åó„ÅÇ„Åë„ÇãÔºâ</div>
        </div>
    </div>
</div>

<script>
/* ============================================================
   DATA
   ============================================================ */
const fingeringData = {
    "C4":  { label:"‰Ωé„ÅÑ„Éâ",      shortLabel:"‰Ωé„Éâ",    type:"white", holes:[1,1,1,1,1,1,1,1] },
    "C#4": { label:"„Éâ‚ôØ/„É¨‚ô≠",    shortLabel:"„Éâ‚ôØ",    type:"black", holes:[1,1,1,1,1,1,1,2] },
    "D4":  { label:"„É¨",          shortLabel:"„É¨",      type:"white", holes:[1,1,1,1,1,1,1,0] },
    "D#4": { label:"„É¨‚ôØ/„Éü‚ô≠",    shortLabel:"„É¨‚ôØ",    type:"black", holes:[1,1,1,1,1,1,2,0] },
    "E4":  { label:"„Éü",          shortLabel:"„Éü",      type:"white", holes:[1,1,1,1,1,1,0,0] },
    "F4":  { label:"„Éï„Ç°",        shortLabel:"„Éï„Ç°",    type:"white", holes:[1,1,1,1,1,0,0,0] },
    "F#4": { label:"„Éï„Ç°‚ôØ/„ÇΩ‚ô≠",  shortLabel:"„Éï„Ç°‚ôØ",  type:"black", holes:[1,1,1,1,0,1,1,0] },
    "G4":  { label:"„ÇΩ",          shortLabel:"„ÇΩ",      type:"white", holes:[1,1,1,1,0,0,0,0] },
    "G#4": { label:"„ÇΩ‚ôØ/„É©‚ô≠",    shortLabel:"„ÇΩ‚ôØ",    type:"black", holes:[1,1,1,0,1,1,2,0] },
    "A4":  { label:"„É©",          shortLabel:"„É©",      type:"white", holes:[1,1,1,0,0,0,0,0] },
    "A#4": { label:"„É©‚ôØ/„Ç∑‚ô≠",    shortLabel:"„É©‚ôØ",    type:"black", holes:[1,1,0,1,1,0,0,0] },
    "B4":  { label:"„Ç∑",          shortLabel:"„Ç∑",      type:"white", holes:[1,1,0,0,0,0,0,0] },
    "C5":  { label:"È´ò„ÅÑ„Éâ",      shortLabel:"È´ò„Éâ",    type:"white", holes:[1,0,1,0,0,0,0,0] },
    "C#5": { label:"È´ò„ÅÑ„Éâ‚ôØ",     shortLabel:"È´ò„Éâ‚ôØ",  type:"black", holes:[0,1,1,0,0,0,0,0] },
    "D5":  { label:"È´ò„ÅÑ„É¨",      shortLabel:"È´ò„É¨",    type:"white", holes:[0,0,1,0,0,0,0,0] },
    "D#5": { label:"È´ò„ÅÑ„É¨‚ôØ",     shortLabel:"È´ò„É¨‚ôØ",  type:"black", holes:[0,0,1,1,1,1,1,0] },
    "E5":  { label:"È´ò„ÅÑ„Éü",      shortLabel:"È´ò„Éü",    type:"white", holes:[3,1,1,1,1,1,0,0] },
};

const PARSE_MAP = [
    ["È´ò„ÅÑ„É¨‚ôØ","D#5"],["È´ò„ÅÑ„É¨#","D#5"],["È´ò„ÅÑ„É¨b","D#5"],
    ["È´ò„ÅÑ„Éâ‚ôØ","C#5"],["È´ò„ÅÑ„Éâ#","C#5"],
    ["È´ò„ÅÑ„Éü","E5"],["È´ò„ÅÑ„É¨","D5"],["È´ò„ÅÑ„Éâ","C5"],
    ["„Éï„Ç°‚ôØ","F#4"],["„Éï„Ç°#","F#4"],["„Éï„Ç°b","F#4"],
    ["„ÇΩ‚ôØ","G#4"],["„ÇΩ#","G#4"],["„ÇΩb","G#4"],
    ["„É©‚ôØ","A#4"],["„É©#","A#4"],["„É©b","A#4"],
    ["„Å©‚ôØ","C#4"],["„Å©#","C#4"],["„Éâb","C#4"],["„Éâ‚ôØ","C#4"],["„Éâ#","C#4"],
    ["„Çå‚ôØ","D#4"],["„Çå#","D#4"],["„É¨b","D#4"],["„É¨‚ôØ","D#4"],["„É¨#","D#4"],
    ["‰Ωé„ÅÑ„Å©","C4"],["‰Ωé„ÅÑ„Éâ","C4"],["‰Ωé„Å©","C4"],["‰Ωé„Éâ","C4"],
    ["„Åµ„ÅÅ","F4"],["„Éï„Ç°","F4"],
    ["„Å©","C4"],["„Éâ","C4"],
    ["„Çå","D4"],["„É¨","D4"],
    ["„Åø","E4"],["„Éü","E4"],
    ["„Åù","G4"],["„ÇΩ","G4"],
    ["„Çâ","A4"],["„É©","A4"],
    ["„Åó","B4"],["„Ç∑","B4"],
];

function parseNoteText(text) {
    const result = [];
    let i = 0;
    while (i < text.length) {
        let matched = false;
        for (const [pattern, key] of PARSE_MAP) {
            if (text.startsWith(pattern, i)) {
                result.push(key);
                i += pattern.length;
                matched = true;
                break;
            }
        }
        if (!matched) i++;
    }
    return result;
}

/* ============================================================
   HELPERS
   ============================================================ */
const SM = {0:'open', 1:'closed', 2:'half', 3:'thumb-half'};

function holeClass(s) { return SM[s] || 'open'; }

function buildKeyboard(container, onNoteClick) {
    for (const [note, data] of Object.entries(fingeringData)) {
        const btn = document.createElement('div');
        btn.className = 'key ' + data.type;
        btn.dataset.note = note;
        btn.setAttribute('role', 'button');
        btn.setAttribute('tabindex', '0');
        btn.setAttribute('aria-label', data.label);
        let lbl = data.label;
        if (data.type === 'black') lbl = data.label.replace('/', '<br>');
        else if (data.label.includes('È´ò„ÅÑ') || data.label.includes('‰Ωé„ÅÑ')) lbl = data.label.replace('„ÅÑ', '„ÅÑ<br>');
        btn.innerHTML = lbl;
        btn.addEventListener('click', () => onNoteClick(note, btn));
        btn.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); onNoteClick(note, btn); } });
        container.appendChild(btn);
    }
}

/* ============================================================
   TAB SWITCHING
   ============================================================ */
document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
    });
});

/* ============================================================
   TAB 1: FINGERING MODE
   ============================================================ */
let currentActiveKey1 = null;
const displayNoteEl = document.getElementById('display-note');

buildKeyboard(document.getElementById('keyboard'), (note, btn) => {
    if (currentActiveKey1) currentActiveKey1.classList.remove('active');
    btn.classList.add('active');
    currentActiveKey1 = btn;
    const data = fingeringData[note];
    displayNoteEl.textContent = data.label.replace('/', ' / ');
    displayNoteEl.classList.remove('bump');
    requestAnimationFrame(() => displayNoteEl.classList.add('bump'));
    updateMainRecorder(data.holes);
});

function updateMainRecorder(holes) {
    holes.forEach((s, i) => {
        const el = document.getElementById('hole-' + i);
        el.classList.remove('open','closed','half','thumb-half');
        el.classList.add(holeClass(s));
    });
}

/* ============================================================
   TAB 2: SCORE MODE
   ============================================================ */
let sequence = [];

buildKeyboard(document.getElementById('score-keyboard'), (note) => {
    addNote(note);
});

document.getElementById('parse-btn').addEventListener('click', () => {
    const input = document.getElementById('score-text-input');
    const notes = parseNoteText(input.value);
    if (notes.length > 0) {
        notes.forEach(k => sequence.push(k));
        input.value = '';
        renderSequence(true);
    } else {
        input.style.borderColor = 'var(--accent)';
        input.style.boxShadow = '0 0 0 3px rgba(232,82,26,0.18)';
        setTimeout(() => { input.style.borderColor = ''; input.style.boxShadow = ''; }, 1200);
    }
});
document.getElementById('score-text-input').addEventListener('keydown', e => {
    if (e.key === 'Enter') document.getElementById('parse-btn').click();
});

document.getElementById('delete-last-btn').addEventListener('click', () => {
    if (sequence.length > 0) { sequence.pop(); renderSequence(false); }
});
document.getElementById('clear-all-btn').addEventListener('click', () => {
    sequence = []; renderSequence(false);
});

function addNote(noteKey) {
    sequence.push(noteKey);
    renderSequence(true);
}

function deleteNoteAt(index) {
    sequence.splice(index, 1);
    renderSequence(false);
}

function renderSequence(scrollToEnd) {
    const container = document.getElementById('seq-container');
    const emptyEl   = document.getElementById('seq-empty');
    const countEl   = document.getElementById('seq-count');
    const printBtn  = document.getElementById('print-btn');

    countEl.textContent = sequence.length + ' Èü≥';
    printBtn.disabled = sequence.length === 0;

    container.querySelectorAll('.seq-card').forEach(c => c.remove());

    if (sequence.length === 0) {
        emptyEl.style.display = 'flex';
        return;
    }
    emptyEl.style.display = 'none';

    sequence.forEach((noteKey, idx) => {
        const data = fingeringData[noteKey];
        const hc = data.holes.map(holeClass);
        const card = document.createElement('div');
        card.className = 'seq-card';
        card.innerHTML = `
            <div class="seq-card-inner">
                <button class="seq-delete-btn" aria-label="ÂâäÈô§">‚úï</button>
                <div class="seq-step-num">${idx + 1}</div>
                <div class="seq-note-name">${data.shortLabel}</div>
                <div class="mini-recorder">
                    <div class="mini-hole ${hc[0]}"></div>
                    <div class="mini-hole ${hc[1]}"></div>
                    <div class="mini-hole ${hc[2]}"></div>
                    <div class="mini-hole ${hc[3]}"></div>
                    <div class="mini-divider"></div>
                    <div class="mini-hole ${hc[4]}"></div>
                    <div class="mini-hole ${hc[5]}"></div>
                    <div class="mini-hole double ${hc[6]}"></div>
                    <div class="mini-hole double ${hc[7]}"></div>
                </div>
            </div>`;
        card.querySelector('.seq-delete-btn').addEventListener('click', e => {
            e.stopPropagation();
            deleteNoteAt(idx);
        });
        container.appendChild(card);
    });

    if (scrollToEnd) {
        const wrap = document.querySelector('.sequence-scroll-wrap');
        setTimeout(() => { wrap.scrollLeft = wrap.scrollWidth; }, 40);
    }
}

/* ============================================================
   PRINT
   ============================================================ */
document.getElementById('print-btn').addEventListener('click', () => {
    if (sequence.length === 0) return;
    buildPrintSheet();
    window.print();
});

function buildPrintSheet() {
    // Title
    const titleInput = document.getElementById('print-title-input').value.trim();
    document.getElementById('print-sheet-title').textContent =
        titleInput || '„ÇΩ„Éó„É©„Éé„É™„Ç≥„Éº„ÉÄ„Éº Êåá„Å•„Åã„ÅÑ';

    // Cards
    const grid = document.getElementById('print-cards-grid');
    grid.innerHTML = '';

    sequence.forEach((noteKey, idx) => {
        const data = fingeringData[noteKey];
        const hc = data.holes.map(holeClass);
        const card = document.createElement('div');
        card.className = 'print-card';
        card.innerHTML = `
            <div class="print-card-num">${idx + 1}</div>
            <div class="print-card-name">${data.shortLabel}</div>
            <div class="print-recorder">
                <div class="print-hole ${hc[0]}"></div>
                <div class="print-hole ${hc[1]}"></div>
                <div class="print-hole ${hc[2]}"></div>
                <div class="print-hole ${hc[3]}"></div>
                <div class="print-divider"></div>
                <div class="print-hole ${hc[4]}"></div>
                <div class="print-hole ${hc[5]}"></div>
                <div class="print-hole double ${hc[6]}"></div>
                <div class="print-hole double ${hc[7]}"></div>
            </div>`;
        grid.appendChild(card);
    });
}

/* ============================================================
   INIT
   ============================================================ */
window.addEventListener('load', () => {
    document.querySelector('#keyboard .key[data-note="C4"]').click();
    document.querySelector('.keyboard-scroll').scrollLeft = 0;
    renderSequence(false);
});
</script>
</body>
</html>
